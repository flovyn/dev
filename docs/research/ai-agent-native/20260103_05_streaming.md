# Streaming and Real-Time Patterns

## 5.1 Streaming Architecture

**All modern AI agents use streaming for UX:**

```
┌─────────────────────────────────────────────────┐
│           STREAMING PIPELINE                     │
├─────────────────────────────────────────────────┤
│ LLM API (SSE) → Chunk Parser → Event Emitter    │
│                      ↓                           │
│              Typed Events:                       │
│              - content (text delta)              │
│              - thinking (reasoning)              │
│              - tool_call_start                   │
│              - tool_call_delta (args streaming)  │
│              - tool_call_end                     │
│              - tool_result                       │
│              - error                             │
│              - finished                          │
└─────────────────────────────────────────────────┘
```

**Gemini CLI Implementation:**
```typescript
// Layered streaming architecture
for await (const event of client.sendMessageStream(...)) {
  switch (event.type) {
    case 'content': ui.displayText(event.value); break;
    case 'thought': ui.displayThinking(event.value); break;
    case 'tool_call_request': await scheduler.schedule(...); break;
    case 'finished': ui.showComplete(); break;
  }
}
```

**Source:** `flovyn-server/gemini-cli/packages/core/src/core/client.ts`

## 5.2 Tool Argument Streaming

**Dyad's XML Streaming Pattern:**
```typescript
// Stream tool arguments as they're generated
case "tool-input-delta": {
  entry.argsAccumulated += part.delta;
  partial = parsePartialJson(entry.argsAccumulated);
  xml = toolDef.buildXml(partial, false);  // Live preview
  ctx.onXmlStream(xml);
}

case "tool-input-end": {
  xml = toolDef.buildXml(args, true);  // Final version
  ctx.onXmlComplete(xml);  // Persist to DB
}
```

**Source:** `flovyn-server/dyad/src/pro/main/ipc/handlers/local_agent/local_agent_handler.ts`

## 5.3 Event Types

| Event Type | Purpose | Contains |
|------------|---------|----------|
| `content` | Text output delta | Text chunk |
| `thinking` | Reasoning output | Thought text |
| `tool_call_start` | Tool invocation begins | Tool name, call ID |
| `tool_call_delta` | Arguments streaming | Partial JSON |
| `tool_call_end` | Tool call complete | Full arguments |
| `tool_result` | Tool execution result | Output, status |
| `error` | Error occurred | Error details |
| `finished` | Turn complete | Final status |

## 5.4 Backpressure Handling

**Considerations for streaming:**
- Buffer size limits
- Client disconnect handling
- Pause/resume capability
- Error recovery mid-stream
