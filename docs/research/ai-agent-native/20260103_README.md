# AI Agent Production Requirements Research

Date: 2025-12-31

## Executive Summary

This research analyzes 9 production AI agent frameworks to identify common patterns, architectural decisions, and requirements for running AI agents in production. The goal is to understand how Flovyn's durable execution system can better serve AI agent workloads.

## Frameworks Analyzed

| Framework | Type | Language | Source |
|-----------|------|----------|--------|
| [Temporal AI Agent](https://github.com/temporalio/temporal-ai-agent) | Durable Workflow Agent | Python | Temporal |
| [Hatchet](https://github.com/hatchet-dev/hatchet) | Workflow Engine | Go | Hatchet |
| [Restate](https://github.com/restatedev/restate) | Durable Execution | Rust | Restate |
| [Gemini CLI](https://github.com/google-gemini/gemini-cli) | CLI Agent | TypeScript | Google |
| [OpenAI Codex](https://github.com/openai/codex) | Sandboxed Agent | Rust | OpenAI |
| [Open Interpreter](https://github.com/openinterpreter/open-interpreter) | Code Execution Agent | Python | Open Source |
| [Dyad](https://github.com/dyad-sh/dyad) | Desktop AI Builder | TypeScript | Open Source |
| [Libra](https://github.com/libra-ai/libra) | Web Dev Platform | TypeScript | Open Source |
| [OpenManus](https://github.com/mannaandpoem/OpenManus) | Agent Framework | Python | Open Source |

## Document Structure

| Document | Description |
|----------|-------------|
| [01-architecture-patterns.md](./20260103_01_architecture_patterns.md) | Agent loop, tool system, state management |
| [02-context-management.md](./20260103_02_context_management.md) | Context window management deep dive |
| [03-durable-execution.md](./20260103_03_durable_execution.md) | Durable execution requirements |
| [04-human-in-the-loop.md](./20260103_04_human_in_the_loop.md) | Approval flows and HITL patterns |
| [05-streaming.md](./20260103_05_streaming.md) | Streaming and real-time patterns |
| [06-safety-sandboxing.md](./20260103_06_safety_sandboxing.md) | Safety and sandboxing |
| [07-observability.md](./20260103_07_observability.md) | Observability and telemetry |
| [08-error-handling.md](./20260103_08_error_handling.md) | Error handling patterns |
| [09-mcp-integration.md](./20260103_09_mcp_integration.md) | MCP (Model Context Protocol) |
| [10-flovyn-opportunities.md](./20260103_10_flovyn_opportunities.md) | Recommendations for Flovyn |
| [11-content-storage-strategy.md](./20260103_11_content_storage_strategy.md) | Content-addressed storage for events + context |
| [12-developer-experience.md](./20260103_12_developer_experience.md) | Agent API, tools, multi-agent patterns |
| [13-workflow-patterns.md](./20260103_13_workflow_patterns.md) | LLM workflows vs agents, LlmTask API |
| [14-mvp-implementation.md](./20260103_14_mvp_implementation.md) | MVP research: mock LLM, test scenarios, components |

## Key Takeaways

### Universal Requirements

1. **Durable execution** - LLM calls must survive failures
2. **Human-in-the-loop** - Approval flows are essential
3. **Streaming** - Real-time feedback is expected
4. **Safety** - Multi-layer defense is standard
5. **Observability** - Full conversation replay required
6. **Context management** - Automatic compression is critical for long-running agents

### Context Management Best Practices

| Practice | Recommendation | Source |
|----------|----------------|--------|
| **Compression trigger** | 70% of context window | Gemini CLI |
| **Split strategy** | Only at user message boundaries | Gemini CLI |
| **Preserve ratio** | Keep latest 30% unchanged | Gemini CLI |
| **Summary format** | Structured XML with goal/facts/plan | Gemini CLI |
| **Tool call fidelity** | Store raw SDK messages | Dyad |
| **Workflow integration** | Use continue-as-new | Temporal |

### Content Storage Strategy

| Practice | Recommendation |
|----------|----------------|
| **Event payloads** | Store references, not content |
| **Large content** | Separate content store (DB or object storage) |
| **Deduplication** | Content-addressed (hash-based) |
| **Checkpoints** | Store compression summaries as content |
| **Lifecycle** | Tiered retention (hot/warm/cold) |

### Differentiation Opportunities for Flovyn

| Opportunity | Why Flovyn | Competitors |
|-------------|------------|-------------|
| **Event-sourced agents** | Native support | Temporal only |
| **Multi-org agents** | Built-in | Manual setup |
| **Hybrid local/cloud** | Worker model | Limited |
| **Enterprise security** | JWT/RBAC ready | Basic |
| **Context checkpointing** | Event log + checkpoints | None native |

### Recommended Roadmap

0. **Phase 0**: Content-addressed store for large payloads (foundational)
1. **Phase 1**: Add approval primitives (Promise-based HITL)
2. **Phase 2**: Add streaming task output
3. **Phase 3**: Add agent workflow template with context management
4. **Phase 4**: Add MCP server integration
5. **Phase 5**: Add sandboxing policies
6. **Phase 6**: Add context compression strategies (LLM + algorithmic)

## Source Code References

All analyzed repositories are available at `~/Developer/manhha/tmp/`:
- `temporal-ai-agent/`
- `hatchet/`
- `restate/`
- `gemini-cli/`
- `codex/`
- `open-interpreter/`
- `dyad/`
- `libra/`
- `OpenManus/`
