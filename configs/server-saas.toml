# Flovyn Server - SaaS Configuration
# Multi-org, dynamic org creation

database_url = "postgres://flovyn:flovyn@localhost:5435/flovyn"
server_port = 8000
grpc_server_port = 9090

# NATS Messaging
[nats]
enabled = true
url = "nats://localhost:4222"

# OpenTelemetry
[otel]
enabled = true
otlp_endpoint = "http://localhost:4317"
service_name = "flovyn-server"

# Metrics
[metrics]
enabled = true
port = 9093

# No pre-configured orgs in SaaS mode
# Orgs are created via POST /api/orgs from flovyn-app

# Authentication
[auth]
enabled = true

# JWT (skip verification for dev)
[auth.jwt]
skip_verification = true

# Better Auth (API keys and JWTs from flovyn-app)
[auth.better_auth]
validation_url = "http://localhost:3000/api/auth/validate-key"
timeout_secs = 5

[auth.better_auth.jwt]
jwks_uri = "http://localhost:3000/.well-known/jwks.json"
issuer = "http://localhost:3000"
audience = "flovyn-server"
skip_verification = false

# Worker tokens
[auth.worker_token]
prefix = "fwt_"

# Attribute resolver
[auth.attr_resolver]
resolver_type = "noop"

# HTTP endpoints
[auth.endpoints.http]
authenticators = ["better_auth_jwt", "better_auth_api_key"]
authorizer = "cedar"
exclude_paths = ["/_/health", "/api/docs", "/api/docs/openapi.json"]

# gRPC endpoints
[auth.endpoints.grpc]
authenticators = ["better_auth_jwt", "better_auth_api_key"]
authorizer = "cedar"
